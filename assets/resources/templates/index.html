{% extends "base.html" %}
{% block title %}–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏{% endblock %}
{% block content %}
<h1 style="margin-top: 0;">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
<form id="main-settings-form" class="data-block">
    <label>
        <div class="label-flex">
            <span>‚≠êÔ∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–º—è:</span>
            <select name="needname">
                <option value="true" {% if settings.get('needname') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('needname') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ ¬´–î–∞¬ª, –ø–æ–º–æ—â–Ω–∏–∫ –±—É–¥–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ –∏–º–µ–Ω–∏.</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üìØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∑–≤—É—á–∫—É:</span>
            <select name="usevoice">
                <option value="true" {% if settings.get('usevoice') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('usevoice') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–í–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–∫–ª–∏–∫ –ø–æ–º–æ—â–Ω–∏–∫–∞.</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üé∫ –ì—Ä–æ–º–∫–æ—Å—Ç—å –≥–æ–ª–æ—Å–∞:</span>
            <input type="number" name="volume" value="{{ (settings.get('volume', '') * 100)|int }}" class="small-input" min="0" max="100" step="5">
            <p>%</p>
        </div>
        
        <small class="hint">*–í–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–∫–ª–∏–∫ –ø–æ–º–æ—â–Ω–∏–∫–∞.</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üìÇ –ò–º—è –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –æ–∑–≤—É—á–∫–∏:</span>
            <input type="text" name="voicename" value="{{ settings.get('voicename', '') }}" class="def-input">
        </div>
        <small class="hint">*–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –æ–∑–≤—É—á–∫–∏ files/voices/.../</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üé≠ –ò–º–µ–Ω–∞ –¥–ª—è –æ—Ç–∫–ª–∏–∫–∞:</span>
            <input type="text" name="names" value="{{ ', '.join(settings.get('names', [])) }}">
        </div>
        <small class="hint">*–°–ø–∏—Å–æ–∫ –∏–º—ë–Ω, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ—â–Ω–∏–∫ –±—É–¥–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</small>
    </label>
    <div class="btn-with-status">
        <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button><div id="main-save-status" class="save-status"></div>
    </div>
</form>

<h1>–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ—è</h1>
<form id="tray-settings-form" class="data-block">
    <label>
        <div class="label-flex">
            <span>üõ†Ô∏è –§—É–Ω–∫—Ü–∏–∏:</span>
            <select name="functions">
                <option value="true" {% if settings.get('tray_view').get('functions') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('functions') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –§—É–Ω–∫—Ü–∏–π (–ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –Ω–∞ redlite.ru/orbit)</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üìú –õ–æ–≥–∏:</span>
            <select name="logs">
                <option value="true" {% if settings.get('tray_view').get('logs') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('logs') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –õ–æ–≥–æ–≤ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –û—Ä–±–∏—Ç–∞)</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</span>
            <select name="sync">
                <option value="true" {% if settings.get('tray_view').get('sync') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('sync') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏)</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üß© –ú–æ–¥—É–ª–∏:</span>
            <select name="modules">
                <option value="true" {% if settings.get('tray_view').get('modules') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('modules') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ú–æ–¥—É–ª–µ–π (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∞ –≤—ã–±–æ—Ä)</small>
    </label>
    <label>
        <div class="label-flex">
            <span>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏:</span>
            <select name="settings">
                <option value="true" {% if settings.get('tray_view').get('settings') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('settings') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ù–∞—Å—Ç—Ä–æ–µ–∫ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—É)</small>
    </label>
    <label>
        <div class="label-flex">
            <span>üö™ –í—ã—Ö–æ–¥:</span>
            <select name="exit">
                <option value="true" {% if settings.get('tray_view').get('exit') %}selected{% endif %}>–î–∞</option>
                <option value="false" {% if not settings.get('tray_view').get('exit') %}selected{% endif %}>–ù–µ—Ç</option>
            </select>
        </div>
        <small class="hint">*–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –í—ã—Ö–æ–¥ (–ø–æ–ª–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –û—Ä–±–∏—Ç–∞)</small>
    </label>
    <div class="btn-with-status">
        <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><div id="tray-save-status" class="save-status"></div>
    </div>
</form>
<script>

    const settings = JSON.parse('{{ settings | tojson | safe }}');
    document.getElementById('main-settings-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
            ...settings,
            needname: form.needname.value === 'true',
            usevoice: form.usevoice.value === 'true',
            names: form.names.value.split(',').map(s => s.trim()).filter(Boolean),
            voicename: form.voicename.value,
            volume: form.volume.value/100
        };
        try {
            await axios.post('/api/settings/main', data);
            document.getElementById('main-save-status').textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
        } catch (err) {
            document.getElementById('main-save-status').textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!';
        }
    });

    document.getElementById('tray-settings-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
            ...settings,
            functions: form.functions.value === 'true',
            logs: form.logs.value === 'true',
            sync: form.sync.value === 'true',
            modules: form.modules.value === 'true',
            settings: form.settings.value === 'true',
            exit: form.exit.value === 'true',
        };
        try {
            await axios.post('/api/settings/tray', data);
            document.getElementById('tray-save-status').textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
        } catch (err) {
            document.getElementById('tray-save-status').textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!';
        }
    });

</script>
{% endblock %}