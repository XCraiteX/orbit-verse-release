{% extends "base.html" %}
{% block title %}–ú–æ–¥—É–ª–∏{% endblock %}
{% block content %}
<h1 style="margin-top: 0;">–ú–æ–¥—É–ª–∏</h1>
<div class="data-block" style="width: 100%; max-width: none; box-sizing: border-box;">
    <form id="tgremote-form" autocomplete="off">
        <div class="label-flex" style="align-items: center; margin-bottom: 24px; gap: 16px;">
            <div style="flex:1; min-width:0;">
                <div style="font-size: 1.15em; font-weight: 600; margin-bottom: 2px;">üß© –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram</div>
                <div class="hint" style="color:#7faaff; font-size: 0.98em;">–ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞. –í–∫–ª—é—á–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–∞.</div>
            </div>
            <label class="switch" style="margin-left: auto;">
                <input type="checkbox" id="tgremote-enabled">
                <span class="slider round"></span>
            </label>
        </div>
        <div id="tgremote-fields" style="display: none; margin-top: 24px;">
            <label style="display:block; width:100%; margin-bottom: 28px;">
                <span style="font-weight:500; display:block; margin-bottom:8px;">ü§ñ –¢–æ–∫–µ–Ω –±–æ—Ç–∞</span>
                <input type="text" id="tgremote-token" name="token" class="def-input" style="width:100%; margin-top:8px;" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞">
                <span class="hint">*–¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É <a href='https://t.me/BotFather'  style="color: #49b6fe;" target='_blank'>@BotFather</a> –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞</span>
            </label>
            <label style="display:block; width:100%; margin-bottom: 28px;">
                <span style="font-weight:500; display:block; margin-bottom:8px;">üë§ –í–∞—à Telegram User ID</span>
                <input type="text" id="tgremote-userid" name="user_id" class="def-input" style="width:100%; margin-top:8px;" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π Telegram User ID">
                <span class="hint">*User ID –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ <a href='https://t.me/ff_uid_bot' style="color: #49b6fe;" target='_blank'>@ff_uid_bot</a></span>
            </label>
            <div class="info-block" style="background:#232e45; color:#a3c7ff; border-radius:8px; padding:12px 16px; margin-bottom: 24px; font-size:0.98em;">
                <b>–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?</b><br>
                <ul style="margin: 8px 0 0 18px; padding: 0; color:#a3c7ff;">
                    <li>–í–∫–ª—é—á–∞–π—Ç–µ –∏ –≤—ã–∫–ª—é—á–∞–π—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä —É–¥–∞–ª—ë–Ω–Ω–æ</li>
                    <li>–ü–æ–ª—É—á–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞ –ø—Ä—è–º–æ –≤ Telegram</li>
                </ul>
            </div>
        </div>
    </form>
</div>

<!-- –û–±—â–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π -->
<div class="btn-with-status" style="margin-top: 32px; width:100%;">
    <button type="button" id="save-all-modules" style="width:100%; font-size:1.08em;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏</button>
    <div id="save-all-status"></div>
</div>

<style>
.switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
}
.switch input {display:none;}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px; width: 18px;
  left: 3px; bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4fa3ff;
}
input:checked + .slider:before {
  transform: translateX(24px);
}
.hint {
  color: #7faaff;
  font-size: 0.97em;
  margin-top: 4px;
  display: block;
}
.info-block {
  background: #232e45;
  color: #a3c7ff;
  border-radius: 8px;
  padding: 12px 16px;
  margin-bottom: 24px;
  font-size: 0.98em;
}
.data-block {
  width: 100% !important;
  max-width: none !important;
  box-sizing: border-box;
}
</style>

<script>
let tgremote = {};

async function loadTgRemote() {
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–∏–º–µ—Ä: /api/modules/tgremote)
    const resp = await axios.get('/api/modules/tgremote');
    tgremote = resp.data;
    document.getElementById('tgremote-enabled').checked = !!tgremote.enabled;
    document.getElementById('tgremote-token').value = tgremote.token || '';
    document.getElementById('tgremote-userid').value = tgremote.user_id || '';
    updateTgRemoteFields();
}

function updateTgRemoteFields() {
    const enabled = document.getElementById('tgremote-enabled').checked;
    document.getElementById('tgremote-fields').style.display = enabled ? '' : 'none';
}

document.getElementById('tgremote-enabled').addEventListener('change', updateTgRemoteFields);

// –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
document.getElementById('save-all-modules').addEventListener('click', async function() {
    const enabled = document.getElementById('tgremote-enabled').checked;
    const token = document.getElementById('tgremote-token').value.trim();
    const user_id = document.getElementById('tgremote-userid').value.trim();
    const data = { enabled, token, user_id };
    
    try {
        await axios.post('/api/modules/tgremote', data);
        document.getElementById('save-all-status').textContent = '–í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
        setTimeout(() => document.getElementById('save-all-status').textContent = '', 2000);
    } catch (err) {
        document.getElementById('save-all-status').textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!';
    }
});

loadTgRemote();
</script>
{% endblock %}
